<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Alt Text Generator</title>
  <style>
    /* --- Reset & Base --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; padding: 20px; display: flex; align-items: center; justify-content: center; 
    }

    /* --- Container --- */
    .container { 
      background: white; border-radius: 20px; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
      max-width: 1000px; width: 100%; padding: 40px; display: flex; gap: 40px; flex-wrap: wrap;
    }

    h1 { color: #333; margin-bottom: 10px; font-size: 2em; width: 100%; }
    .subtitle { color: #666; margin-bottom: 30px; font-size: 0.95em; width: 100%; }

    /* --- Left Column --- */
    .left-column { flex: 1 1 300px; min-width: 280px; display: flex; flex-direction: column; gap: 20px; }

    .api-key-section { background: #e8f5e9; border: 2px solid #4caf50; border-radius: 10px; padding: 15px; }
    .api-key-section.hidden { display: none; }
    .api-key-label { color: #2e7d32; font-weight: 600; margin-bottom: 8px; font-size: 0.9em; }
    .api-key-input-wrapper { display: flex; gap: 10px; margin-bottom: 8px; }
    .api-key-input { flex: 1; padding: 10px 12px; border: 2px solid #4caf50; border-radius: 8px; font-size: 0.95em; font-family: monospace; }
    .api-key-btn { background: #4caf50; color: white; padding: 10px 20px; font-size: 0.9em; cursor: pointer; }
    .api-key-btn:hover { background: #45a049; }
    .api-key-hint { color: #2e7d32; font-size: 0.85em; display: flex; align-items: center; gap: 5px; }
    .api-key-hint a { color: #2e7d32; text-decoration: underline; }

    .url-input-wrapper { display: flex; gap: 10px; }
    input[type="text"] { flex: 1; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; transition: border-color 0.3s; }
    input[type="text"]:focus { outline: none; border-color: #667eea; }
    button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 10px; font-size: 1em; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }
    button:active { transform: translateY(0); }
    button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

    .upload-area { border: 3px dashed #667eea; border-radius: 15px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #f8f9ff; }
    .upload-area:hover { border-color: #764ba2; background: #f0f2ff; }
    .upload-area.dragover { border-color: #764ba2; background: #e8eaff; transform: scale(1.02); }
    .upload-area.disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; }
    .upload-icon { font-size: 3em; margin-bottom: 15px; }
    .upload-text { color: #667eea; font-size: 1.1em; font-weight: 600; margin-bottom: 8px; }
    .upload-hint { color: #999; font-size: 0.9em; }
    #fileInput { display: none; }

    /* --- Right Column --- */
    .right-column { flex: 1 1 300px; min-width: 300px; display: flex; flex-direction: column; gap: 20px; }

    .preview-container { display: flex; flex-direction: column; gap: 20px; }
    .image-preview { width: 100%; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

    .result-section { background: #f8f9ff; padding: 20px; border-radius: 15px; display: flex; flex-direction: column; justify-content: space-between; }
    .result-label { color: #667eea; font-weight: 600; margin-bottom: 10px; font-size: 0.95em; text-transform: uppercase; letter-spacing: 0.5px; }
    .alt-text-display { background: white; padding: 15px; border-radius: 10px; border: 2px solid #e0e0e0; margin-bottom: 15px; font-size: 1em; line-height: 1.6; color: #333; min-height: 60px; }
    .copy-btn { background: #4caf50; padding: 10px 20px; font-size: 0.9em; align-self: flex-start; }
    .copy-btn:hover { box-shadow: 0 5px 15px rgba(76,175,80,0.4); }

    /* --- Loading & Errors --- */
    .loading { display: none; text-align: center; padding: 20px; }
    .loading.active { display: block; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
    .error.active { display: block; }
    .success { background: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
    .success.active { display: block; }
  </style>
</head>

<body>
  <div class="container">
    <h1>üñºÔ∏è AI Alt Text Generator</h1>
    <p class="subtitle">Upload an image or paste a URL to generate descriptive alt text using AI</p>

    <!-- Left Column: URL + Upload + API Key -->
    <div class="left-column">
      <div class="api-key-section" id="apiKeySection">
        <div class="api-key-label">üîë Google Gemini API Key Required</div>
        <div class="api-key-input-wrapper">
          <input type="password" class="api-key-input" id="apiKeyInput" placeholder="AIzaSy...">
          <button class="api-key-btn" onclick="saveApiKey()">Save Key</button>
        </div>
        <div class="api-key-hint">
          Get your API key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> ‚Ä¢ Stored locally in browser
        </div>
      </div>

      <div class="url-input-wrapper">
        <input type="text" id="urlInput" placeholder="Paste image URL here...">
        <button onclick="loadFromURL()">Load URL</button>
      </div>

      <div class="upload-area" id="uploadArea" onclick="handleUploadClick()">
        <div class="upload-icon">üì§</div>
        <div class="upload-text">Click to upload or drag & drop</div>
        <div class="upload-hint">Supports JPG, PNG, GIF, WebP ‚Ä¢ Or paste from clipboard (Ctrl+V)</div>
        <input type="file" id="fileInput" accept="image/*">
      </div>

      <div class="success" id="successMsg"></div>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Analyzing image with AI...</p>
      </div>
      <div class="error" id="error"></div>
    </div>

    <!-- Right Column: Image Preview + Generated Text -->
    <div class="right-column">
      <div class="preview-container" id="previewSection">
        <img id="imagePreview" class="image-preview" alt="">
        <div class="result-section">
          <div class="result-label">Generated Alt Text:</div>
          <div class="alt-text-display" id="altTextDisplay">Alt text will appear here...</div>
          <button class="copy-btn" onclick="copyAltText()">üìã Copy Alt Text</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const urlInput = document.getElementById('urlInput');
    const imagePreview = document.getElementById('imagePreview');
    const previewSection = document.getElementById('previewSection');
    const altTextDisplay = document.getElementById('altTextDisplay');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const apiKeySection = document.getElementById('apiKeySection');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const successMsg = document.getElementById('successMsg');

    let currentImageData = null;
    let apiKey = localStorage.getItem('gemini_api_key') || '';

    if (apiKey) { apiKeySection.classList.add('hidden'); } 
    else { uploadArea.classList.add('disabled'); }

    function saveApiKey() {
      const key = apiKeyInput.value.trim();
      if (!key) return showError('Please enter a valid API key');
      if (!key.startsWith('AIza')) return showError('Invalid API key format. Should start with "AIza"');
      localStorage.setItem('gemini_api_key', key);
      apiKey = key;
      apiKeySection.classList.add('hidden');
      uploadArea.classList.remove('disabled');
      showSuccess('API key saved successfully!');
    }

    function handleUploadClick() { if (!apiKey) return showError('Please enter your API key first'); fileInput.click(); }

    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); if (apiKey) uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault(); uploadArea.classList.remove('dragover');
      if (!apiKey) return showError('Please enter your API key first');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) handleImageFile(file);
    });

    fileInput.addEventListener('change', (e) => { const file = e.target.files[0]; if (file) handleImageFile(file); });

    document.addEventListener('paste', (e) => {
      if (!apiKey) return showError('Please enter your API key first');
      const items = e.clipboardData.items;
      for (let item of items) { if (item.type.startsWith('image/')) { handleImageFile(item.getAsFile()); break; } }
    });

    async function handleImageFile(file) {
      const reader = new FileReader();
      reader.onload = async (e) => {
        const base64Data = e.target.result.split(',')[1];
        const mimeType = file.type;
        imagePreview.src = e.target.result;
        previewSection.style.display = 'flex';
        currentImageData = { base64Data, mimeType };
        await generateAltText();
      };
      reader.readAsDataURL(file);
    }

    async function loadFromURL() {
      if (!apiKey) return showError('Please enter your API key first');
      const url = urlInput.value.trim();
      if (!url) return showError('Please enter a valid image URL');
      try {
        showLoading(); hideError();
        const response = await fetch(url);
        if (!response.ok) throw new Error('Failed to fetch image');
        const blob = await response.blob();
        if (!blob.type.startsWith('image/')) throw new Error('URL does not point to an image');
        const reader = new FileReader();
        reader.onload = async (e) => {
          const base64Data = e.target.result.split(',')[1];
          const mimeType = blob.type;
          imagePreview.src = e.target.result;
          previewSection.style.display = 'flex';
          currentImageData = { base64Data, mimeType };
          await generateAltText();
        };
        reader.readAsDataURL(blob);
      } catch (err) {
        hideLoading(); showError('Failed to load image from URL.'); console.error(err);
      }
    }

    async function generateAltText() {
      if (!currentImageData || !apiKey) return;
      showLoading(); hideError();

      const payload = {
        contents: [{
          parts: [
            { text: "Generate a concise, descriptive alt text suitable for accessibility (1-2 sentences). Do NOT include 'alt text:' or 'description:'." },
            { inlineData: { mimeType: currentImageData.mimeType, data: currentImageData.base64Data } }
          ]
        }]
      };

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          const errorData = await response.json();
          if (response.status === 400 && errorData.error?.message?.includes('API_KEY_INVALID')) {
            localStorage.removeItem('gemini_api_key');
            apiKey = ''; apiKeySection.classList.remove('hidden'); uploadArea.classList.add('disabled');
            throw new Error('Invalid API key. Please enter a valid key.');
          }
          throw new Error(errorData.error?.message || 'API request failed');
        }

        const data = await response.json();
        const text = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
        if (text) altTextDisplay.textContent = text;
        else throw new Error('Invalid response from AI');
      } catch (err) {
        showError('Failed to generate alt text: ' + err.message);
        console.error(err);
      } finally { hideLoading(); }
    }

    function copyAltText() {
      const text = altTextDisplay.textContent;
      if (text === 'Alt text will appear here...') return;
      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = '‚úì Copied!';
        setTimeout(() => { btn.textContent = originalText; }, 2000);
      }).catch(() => { showError('Failed to copy to clipboard'); });
    }

    function showLoading() { loading.classList.add('active'); }
    function hideLoading() { loading.classList.remove('active'); }
    function showError(msg) { errorDiv.textContent = msg; errorDiv.classList.add('active'); setTimeout(() => { errorDiv.classList.remove('active'); }, 5000); }
    function hideError() { errorDiv.classList.remove('active'); }
    function showSuccess(msg) { successMsg.textContent = msg; successMsg.classList.add('active'); setTimeout(() => { successMsg.classList.remove('active'); }, 3000); }
  </script>
</body>

</html>
